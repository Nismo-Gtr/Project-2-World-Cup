<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/dashboard.css">
    <title>User Dashboard</title>
</head>

<body>
    <!-- Navbar with World Cup 2018 on the left & 'Welcome + Username', Update Preferences Button and Logout Button/Tab on the right -->
    <!-- <nav class="navbar navbar-light bg-light justify-content-between"> -->
    <header>
        <nav class="navbar navbar-expand-lg" id="mainNav">
            <div class="container">
                <a class="navbar-brand" href="home2.html">FIFA WORLD CUP 2018</a>
                <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                    aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fa fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">HOME</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contact.html">BRACKETS</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contact.html">MEET UPS</a>
                        </li>
                        <li class="nav-item active">
                            <!-- Button to Open the Modal -->
                            <a class="nav-link" href='#' data-toggle="modal" data-target="#myModal">
                                UPDATE PREFERENCES
                            </a>

                            <!-- The Modal -->
                            <div class="modal" id="myModal">
                                <div class="modal-dialog">
                                    <div class="modal-content">

                                        <!-- Modal Header -->
                                        <div class="modal-header">
                                            <h4 class="modal-title">User Preferences</h4>
                                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        </div>

                                        <!-- Modal body -->
                                        <div class="modal-body">
                                            <form>
                                                <div class="container">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <h6>Choose upto 3 teams to follow</h6>
                                                        </div>
                                                    </div>
                                                    <div class="row options">
                                                        <div class="col-md-4">
                                                            <select class="custom-select" id="inputGroupSelect01">
                                                                <option selected>Choose...</option>
                                                                <option value="1">Russia</option>
                                                                <option value="2">Saudi Arabia</option>
                                                                <option value="3">Egypt</option>
                                                                <option value="4">Uruguay</option>
                                                                <option value="5">Portugal</option>
                                                                <option value="6">Spain</option>
                                                                <option value="7">Morocco</option>
                                                                <option value="8">Iran</option>
                                                                <option value="9">France</option>
                                                                <option value="10">Australia</option>
                                                                <option value="11">Peru</option>
                                                                <option value="12">Denmark</option>
                                                                <option value="13">Argentina</option>
                                                                <option value="14">Iceland</option>
                                                                <option value="15">Croatia</option>
                                                                <option value="16">Nigeria</option>
                                                                <option value="17">Brazil</option>
                                                                <option value="18">Switzerland</option>
                                                                <option value="19">Costa Rica</option>
                                                                <option value="20">Serbia</option>
                                                                <option value="21">Germany</option>
                                                                <option value="22">Mexico</option>
                                                                <option value="23">Sweden</option>
                                                                <option value="24">South Korea</option>
                                                                <option value="25">Belgium</option>
                                                                <option value="26">Panama</option>
                                                                <option value="27">Tunisia</option>
                                                                <option value="28">England</option>
                                                                <option value="29">Poland</option>
                                                                <option value="30">Senegal</option>
                                                                <option value="31">Columbia</option>
                                                                <option value="32">Japan</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select class="custom-select" id="inputGroupSelect02">
                                                                <option selected>Choose...</option>
                                                                <option value="1">Russia</option>
                                                                <option value="2">Saudi Arabia</option>
                                                                <option value="3">Egypt</option>
                                                                <option value="4">Uruguay</option>
                                                                <option value="5">Portugal</option>
                                                                <option value="6">Spain</option>
                                                                <option value="7">Morocco</option>
                                                                <option value="8">Iran</option>
                                                                <option value="9">France</option>
                                                                <option value="10">Australia</option>
                                                                <option value="11">Peru</option>
                                                                <option value="12">Denmark</option>
                                                                <option value="13">Argentina</option>
                                                                <option value="14">Iceland</option>
                                                                <option value="15">Croatia</option>
                                                                <option value="16">Nigeria</option>
                                                                <option value="17">Brazil</option>
                                                                <option value="18">Switzerland</option>
                                                                <option value="19">Costa Rica</option>
                                                                <option value="20">Serbia</option>
                                                                <option value="21">Germany</option>
                                                                <option value="22">Mexico</option>
                                                                <option value="23">Sweden</option>
                                                                <option value="24">South Korea</option>
                                                                <option value="25">Belgium</option>
                                                                <option value="26">Panama</option>
                                                                <option value="27">Tunisia</option>
                                                                <option value="28">England</option>
                                                                <option value="29">Poland</option>
                                                                <option value="30">Senegal</option>
                                                                <option value="31">Columbia</option>
                                                                <option value="32">Japan</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <select class="custom-select" id="inputGroupSelect03">
                                                                <option selected>Choose...</option>
                                                                <option value="1">Russia</option>
                                                                <option value="2">Saudi Arabia</option>
                                                                <option value="3">Egypt</option>
                                                                <option value="4">Uruguay</option>
                                                                <option value="5">Portugal</option>
                                                                <option value="6">Spain</option>
                                                                <option value="7">Morocco</option>
                                                                <option value="8">Iran</option>
                                                                <option value="9">France</option>
                                                                <option value="10">Australia</option>
                                                                <option value="11">Peru</option>
                                                                <option value="12">Denmark</option>
                                                                <option value="13">Argentina</option>
                                                                <option value="14">Iceland</option>
                                                                <option value="15">Croatia</option>
                                                                <option value="16">Nigeria</option>
                                                                <option value="17">Brazil</option>
                                                                <option value="18">Switzerland</option>
                                                                <option value="19">Costa Rica</option>
                                                                <option value="20">Serbia</option>
                                                                <option value="21">Germany</option>
                                                                <option value="22">Mexico</option>
                                                                <option value="23">Sweden</option>
                                                                <option value="24">South Korea</option>
                                                                <option value="25">Belgium</option>
                                                                <option value="26">Panama</option>
                                                                <option value="27">Tunisia</option>
                                                                <option value="28">England</option>
                                                                <option value="29">Poland</option>
                                                                <option value="30">Senegal</option>
                                                                <option value="31">Columbia</option>
                                                                <option value="32">Japan</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                            </form>
                                            </div>

                                            <!-- Modal footer -->
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="savePreferences">Save Preferences</button>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="logoutButton">
                                LOG OUT
                            </a>
                        </li>

                    </ul>
                    </div>
                </div>
        </nav>
    </header>

    <div class="jumbotron">
        <div class="container">
            <h3>Welcome
                <em>
                    <span id="user"></span>,
                </em>
            </h3>
            <!-- <h3 class="text-center" id="faves">MY FAVORITE TEAMS</h3> -->
            <div class="row teamRow">
                <div class="col-md-4 text-center">
                    <!-- <p>OPTION 1</p> -->
                    <a href="#" class="teamFlag">
                        <img id="img1" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSwnKctiJECJefCrlklL0YxpaaGDkPU9UesuLEQaI77huB_pl9k">
                    </a>
                </div>
                <div class="col-md-8 text-center displayTeam">
                    PORTUGAL
                </div>
            </div>
            <nav>
                <div class="nav nav-tabs d-none" id="nav-tab" role="tablist">
                    <a class="nav-item nav-link active text-center" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home"
                        aria-selected="true">Team Profile</a>
                    <a class="nav-item nav-link text-center" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact"
                        aria-selected="false">Latest News Stories</a>
                </div>
            </nav>
            <div class="tab-content d-none" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav--tab">Lorem ipsum dolor sit amet consectetur adipisicing elit. Debitis voluptates quis incidunt dolorum natus id
                    ad, reiciendis aperiam explicabo, consequuntur in ab dolor, recusandae deleniti delectus laborum. Enim,
                    tempora perferendis!</div>
                <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">Lorem, ipsum dolor sit amet consectetur adipisicing elit. Eaque ut voluptates atque dolorem minima quibusdam
                    mollitia, sapiente cum! Atque molestiae dolorem nisi odio sunt aliquid architecto modi vitae nemo harum.</div>
            </div>

        </div>
        <!-- <div class="row">
            <div class="col-md-12 text-center">
                <h3 id="faves">LOCAL MEETUPS</h3>
                <p>Get Social! Watch games with other passionate fans at a meetup near you.</p>
                <p></p>
                <p>
                    <button class="btn btn-lg btn-success" id="signupButton">Add a meetup</button>
                </p>
            </div>
        </div> -->


    </div>
    <!-- JAVASCRIPT AND JQUERY -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <!-- <script src="./login.js"></script> -->
    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>

    <script type="text/javascript">
        var firebase_config = {
            apiKey: "AIzaSyA5y8GqPO0dVFs5xshZiFdjKgVgN9OlO0M",
            authDomain: "world-cup-2018-2e7ca.firebaseapp.com",
            databaseURL: "https://world-cup-2018-2e7ca.firebaseio.com",
            projectId: "world-cup-2018-2e7ca",
            storageBucket: "world-cup-2018-2e7ca.appspot.com",
            messagingSenderId: "621397211278"
        };

        firebase.initializeApp(firebase_config);
        var database = firebase.database();

        // Retrieve the object from storage
        var retrievedObject = localStorage.getItem('currentUser');
        console.log('retrievedObject: ', JSON.parse(retrievedObject));
        var username = JSON.parse(retrievedObject).username;
        var email = JSON.parse(retrievedObject).email;
        var password = JSON.parse(retrievedObject).password;


        console.log('Logged in User: ', username);
        $('#user').text(username);
        var fave1 = "";
        var fave2 = "";
        var fave3 = "";
        var objectForMyMysql;

        database.ref().on("value", function (snapshot) {
            data = snapshot.val();
            // console.log("DATA: ", data);
            // console.log("==========================");
            var keys = Object.keys(data);
            for (var i = 0; i < keys.length; i++) {
                // console.log("data[keys[i]].email", data[keys[i]].email);

                if (username === data[keys[i]].username) {

                    console.log("found the user");
                    console.log('[keys[i]] (unique id) : ', keys[i]);
                    console.log('Here is his info: ', data[keys[i]]);

                    // here, we can populate the team info.
                    $('.teamFlag').on('click', function () {
                        console.log('clicked');
                        $('#nav-tab').removeClass('d-none');
                        $('#nav-tabContent').removeClass('d-none');

                    });

                    // Capturing favorite teams. Saves IDs that match team ids in database table.
                    // Values stored are strings 
                    $('#savePreferences').on('click', function () {
                        fave1 = $('#inputGroupSelect01').val();
                        fave2 = $('#inputGroupSelect02').val();
                        fave3 = $('#inputGroupSelect03').val();
                        console.log('fave1: ', fave1);
                        console.log('fave2: ', fave2);
                        console.log('fave3: ', fave3);

                        data[keys[i]] = {
                            username: username,
                            email: email,
                            password: password,
                            team1: fave1,
                            team2: fave2,
                            team3: fave3
                        };

                        objectForMyMysql = data[keys[i]];
                        console.log(objectForMyMysql);

                        database.ref().set(data[keys[i]]);
                    });
                }
            }
        });

        // LOGOUT BUTTON
        $('#logoutButton').on('click', e => {
            firebase.auth().signOut();
            window.location.replace('/login');
        });
    </script>
</body>

</html>